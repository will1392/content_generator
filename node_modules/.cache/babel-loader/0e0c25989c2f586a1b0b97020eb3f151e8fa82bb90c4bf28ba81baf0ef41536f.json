{"ast":null,"code":"// services/content.service.ts\nimport { perplexityService } from './ai/perplexity.service';\nimport { supabase } from './supabase.service';\nexport class ContentService {\n  async generateResearch(projectId, keyword) {\n    try {\n      console.log('ContentService: Starting research generation for:', keyword);\n      console.log('ContentService: Project ID:', projectId);\n\n      // Call Perplexity API\n      console.log('ContentService: Calling Perplexity API...');\n      const research = await perplexityService.generateResearch(keyword);\n      console.log('ContentService: Research received from Perplexity');\n\n      // Save to Supabase\n      console.log('ContentService: Saving to Supabase...');\n      await this.saveContent(projectId, 'research', research);\n      console.log('ContentService: Successfully saved to Supabase');\n      return research;\n    } catch (error) {\n      console.error('ContentService: Research generation failed:', error);\n      console.error('ContentService: Error details:', {\n        message: error.message,\n        stack: error.stack,\n        name: error.name\n      });\n      throw new Error(error.message || 'Failed to generate research');\n    }\n  }\n  async saveContent(projectId, stageType, content) {\n    console.log('ContentService: Saving content to database...');\n    console.log('ContentService: Content keys:', Object.keys(content || {}));\n    try {\n      var _data$;\n      // Mark previous versions as not current\n      console.log('ContentService: Marking previous versions as not current...');\n      const {\n        error: updateError\n      } = await supabase.from('content_stages').update({\n        is_current: false\n      }).eq('project_id', projectId).eq('stage_type', stageType);\n      if (updateError) {\n        console.warn('ContentService: Error updating old content (this is okay if no old content exists):', updateError);\n      }\n\n      // Insert new version\n      console.log('ContentService: Inserting new content version...');\n      const {\n        data,\n        error\n      } = await supabase.from('content_stages').insert({\n        project_id: projectId,\n        stage_type: stageType,\n        content,\n        is_current: true,\n        created_at: new Date().toISOString()\n      }).select();\n      if (error) {\n        console.error('ContentService: Database insert error:', error);\n        throw error;\n      }\n      console.log('ContentService: Content saved successfully, record ID:', data === null || data === void 0 ? void 0 : (_data$ = data[0]) === null || _data$ === void 0 ? void 0 : _data$.id);\n    } catch (error) {\n      console.error('ContentService: Save content error:', error);\n      throw error;\n    }\n  }\n}\nexport const contentService = new ContentService();","map":{"version":3,"names":["perplexityService","supabase","ContentService","generateResearch","projectId","keyword","console","log","research","saveContent","error","message","stack","name","Error","stageType","content","Object","keys","_data$","updateError","from","update","is_current","eq","warn","data","insert","project_id","stage_type","created_at","Date","toISOString","select","id","contentService"],"sources":["/Users/will/Content Creation App/src/services/content.service.ts"],"sourcesContent":["// services/content.service.ts\nimport { perplexityService } from './ai/perplexity.service';\nimport { supabase } from './supabase.service';\nimport { ResearchContent } from '../types/project.types';\n\nexport class ContentService {\n  async generateResearch(projectId: string, keyword: string): Promise<ResearchContent> {\n    try {\n      console.log('ContentService: Starting research generation for:', keyword);\n      console.log('ContentService: Project ID:', projectId);\n      \n      // Call Perplexity API\n      console.log('ContentService: Calling Perplexity API...');\n      const research = await perplexityService.generateResearch(keyword);\n      console.log('ContentService: Research received from Perplexity');\n      \n      // Save to Supabase\n      console.log('ContentService: Saving to Supabase...');\n      await this.saveContent(projectId, 'research', research);\n      console.log('ContentService: Successfully saved to Supabase');\n      \n      return research;\n    } catch (error: any) {\n      console.error('ContentService: Research generation failed:', error);\n      console.error('ContentService: Error details:', {\n        message: error.message,\n        stack: error.stack,\n        name: error.name\n      });\n      throw new Error(error.message || 'Failed to generate research');\n    }\n  }\n\n  private async saveContent(\n    projectId: string,\n    stageType: string,\n    content: any\n  ): Promise<void> {\n    console.log('ContentService: Saving content to database...');\n    console.log('ContentService: Content keys:', Object.keys(content || {}));\n    \n    try {\n      // Mark previous versions as not current\n      console.log('ContentService: Marking previous versions as not current...');\n      const { error: updateError } = await supabase\n        .from('content_stages')\n        .update({ is_current: false })\n        .eq('project_id', projectId)\n        .eq('stage_type', stageType);\n\n      if (updateError) {\n        console.warn('ContentService: Error updating old content (this is okay if no old content exists):', updateError);\n      }\n\n      // Insert new version\n      console.log('ContentService: Inserting new content version...');\n      const { data, error } = await supabase\n        .from('content_stages')\n        .insert({\n          project_id: projectId,\n          stage_type: stageType,\n          content,\n          is_current: true,\n          created_at: new Date().toISOString()\n        })\n        .select();\n\n      if (error) {\n        console.error('ContentService: Database insert error:', error);\n        throw error;\n      }\n      \n      console.log('ContentService: Content saved successfully, record ID:', data?.[0]?.id);\n    } catch (error) {\n      console.error('ContentService: Save content error:', error);\n      throw error;\n    }\n  }\n}\n\nexport const contentService = new ContentService();"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}